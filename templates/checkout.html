<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô - DutsadeeStore</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar">
    <div class="navbar-brand brand-logo">
        <img src="{{ url_for('static', filename='images/products/logo.png') }}" alt="Logo">
        <div class="brand-text">
            <h1>DutsadeeStore</h1>
            <p>Gaming GearStore</p>
        </div>
    </div>

    <div class="navbar-menu">
        <a href="/" class="nav-link">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
        <a href="/cart" class="nav-link">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</a>
    </div>
</nav>

<!-- ================= CHECKOUT ================= -->
<main class="container">
    <section class="checkout-section">
        <h2>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

        <div class="checkout-grid">

            <!-- FORM -->
            <div class="checkout-form">
                <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
                <form id="checkoutForm">

                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠ *</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                            <input type="text" id="lastName" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                        <input type="email" id="email" required>
                    </div>

                    <div class="form-group">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                        <input type="tel" id="phone" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà *</label>
                        <textarea id="address" rows="3" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ *</label>
                            <input type="text" id="district" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î *</label>
                            <input type="text" id="province" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå *</label>
                        <input type="text" id="zipcode" required>
                    </div>

                    <button type="submit" class="btn checkout-btn">
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                    </button>
                </form>
            </div>

            <!-- SUMMARY -->
            <div class="order-summary">
                <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>

                {% for item in cart_items %}
                <div class="summary-row">
                    <span>{{ item.name }} √ó {{ item.quantity }}</span>
                    <span>‡∏ø{{ "{:,}".format(item.total) }}</span>
                </div>
                {% endfor %}

                <hr>

                <div class="summary-row">
                    <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
                    <span>‡∏ø{{ "{:,}".format(subtotal) }}</span>
                </div>
                <div class="summary-row">
                    <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                    <span>‡∏ø{{ "{:,}".format(shipping) }}</span>
                </div>
                <div class="summary-row total">
                    <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span>
                    <span>‡∏ø{{ "{:,}".format(total|int) }}</span>
                </div>

                <p class="payment-info">üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
            </div>

        </div>
    </section>
</main>



<script>
document.getElementById("checkoutForm").addEventListener("submit", function (e) {
    e.preventDefault(); // ‚ùó ‡∏´‡∏¢‡∏∏‡∏î form submit ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°

    fetch("/api/order/place", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            // (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ backend ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏Å‡πá‡∏™‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ)
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            // ‚úÖ redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ success
            window.location.href = `/success/${data.order_id}`;
        } else {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
        }
    })
    .catch(err => {
        console.error(err);
        alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
    });
});
</script>


</body>
</html>